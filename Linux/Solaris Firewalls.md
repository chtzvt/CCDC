# Solaris Firewalls :sun: :fire:

_This KB entry is dedicated to Sun Microsystems (we will always remember you)..._

## Useful Firewall Commands
- `svcs -a | grep ipf`: _Check if ipf is running._
- `svcadm restart svc:/network/ipfilter:default` _or_ `ipf -f /etc/ipf/ipf.conf`: _Restart the firewall._
- `ipf -f /etc/ipf/ipf.conf`: _Load rules from a configuration file._
- `ipf -Fa`: _Flush all rules._
- `ipfstat`: _Show statistics._
- `ipfstat -io`: _Display running input and output rulesets._
- `ipmon -s [file]`: _Send ipf logging output to a file._
- `snoop -d <interface name> <filter>`: _Solaris' TCPDump equivalent._

## Configuration Reference

**Location:** `/etc/ipf/ipf.conf`


#### Simple Port Blocking Example

- **Source:** [https://unix.stackexchange.com/questions/373523/solaris-firewall-rules-to-block-a-port-from-external-access/373524](https://unix.stackexchange.com/questions/373523/solaris-firewall-rules-to-block-a-port-from-external-access/373524)

```
allow in quick proto tcp/udp from <ip> to any port = <port_to_block>
block in log proto tcp/udp from any to any port = <port_to_block>
```

#### Example Pf/Iptables Translation

- **Source:** [https://ozlabs.org/~rusty/index.cgi/2006/08/15](https://ozlabs.org/~rusty/index.cgi/2006/08/15)

```
Finally, some advice for people who are translating from one into the other: it's not a trivial conversion. I (roughly) translated the example at the end of the pf FAQ, and then rewrote it how you would really do this in iptables. The NAT stuff is fairly directly mapped (although be aware that iptables filtering is always on "real" addresses, ie. after DNAT/rdr, before SNAT/nat). For filtering, iptables makes you consider the problem in three distinct parts: INPUT (destined for this box), FORWARD (passing through this box) and OUTPUT (generated by this box). Consider the following pf rules:

pass in on $ext_if inet proto tcp from any to ($ext_if) \
   port $tcp_services flags S/SA keep state
pass in on $ext_if inet proto tcp from any to $comp3 port 80 \
    flags S/SA synproxy state

In iptables, these two rules are fundamentally different, and indeed, would unlikely be listed consecutively. The first is an INPUT rule, the second a FORWARD rule:

iptables -A INPUT -i $ext_if -p tcp --dport $tcp_services --syn -j ACCEPT
iptables -A FORWARD -i $ext_if -p tcp -d $comp3 --dport 80 --syn -j ACCEPT
```


#### Example 5-20 IP Filter Host Configuration

- **Source:** [https://docs.oracle.com/cd/E26502_01/html/E28990/ipfad-2.html](https://docs.oracle.com/cd/E26502_01/html/E28990/ipfad-2.html)

This example shows a configuration on a host machine with a net0 network interface.

```
# pass and log everything by default
pass in log on net0 all
pass out log on net0 all

# block, but don't log, incoming packets from other reserved addresses
block in quick on net0 from 10.0.0.0/8 to any
block in quick on net0 from 172.16.0.0/12 to any

# block and log untrusted internal IPs. 0/32 is notation that replaces 
# address of the machine running IP Filter.
block in log quick from 192.168.1.15 to <thishost>
block in log quick from 192.168.1.43 to <thishost>

# block and log X11 (port 6000) and remote procedure call 
# and portmapper (port 111) attempts
block in log quick on net0 proto tcp from any to net0/32 port = 6000 keep state
block in log quick on net0 proto tcp/udp from any to net0/32 port = 111 keep state
```

#### Example 5-21 IP Filter Server Configuration

- **Source:** [https://docs.oracle.com/cd/E26502_01/html/E28990/ipfad-2.html](https://docs.oracle.com/cd/E26502_01/html/E28990/ipfad-2.html)

This example shows a configuration for a host machine acting as a web server. This machine has an net0 network interface.

```
# web server with an net0 interface
# block and log everything by default; 
# then allow specific services
# group 100 - inbound rules
# group 200 - outbound rules
# (0/32) resolves to our IP address)
*** FTP proxy ***

# block short packets which are packets 
# fragmented too short to be real.
block in log quick all with short

# block and log inbound and outbound by default, 
# group by destination
block in log on net0 from any to any head 100
block out log on net0 from any to any head 200


# web rules that get hit most often
pass in quick on net0 proto tcp from any \
to net0/32 port = http flags S keep state group 100
pass in quick on net0 proto tcp from any \
to net0/32 port = https flags S keep state group 100


# inbound traffic - ssh, auth
pass in quick on net0 proto tcp from any \
to net0/32 port = 22 flags S keep state group 100
pass in log quick on net0 proto tcp from any \
to net0/32 port = 113 flags S keep state group 100
pass in log quick on net0 proto tcp from any port = 113 \
to net0/32 flags S keep state group 100

# outbound traffic - DNS, auth, NTP, ssh, WWW, smtp
pass out quick on net0 proto tcp/udp from net0/32 \
to any port = domain flags S keep state group 200
pass in quick on net0 proto udp from any \
port = domain to net0/32 group 100

pass out quick on net0 proto tcp from net0/32 \
to any port = 113 flags S keep state group 200
pass out quick on net0 proto tcp from net0/32 port = 113 \
to any flags S keep state group 200

pass out quick on net0 proto udp from net0/32 to any \
port = ntp group 200
pass in quick on net0 proto udp from any \
port = ntp to net0/32 port = ntp group 100

pass out quick on net0 proto tcp from net0/32 \
to any port = ssh flags S keep state group 200

pass out quick on net0 proto tcp from net0/32 \
to any port = http flags S keep state group 200
pass out quick on net0 proto tcp from net0/32 \
to any port = https flags S keep state group 200

pass out quick on net0 proto tcp from net0/32 \
to any port = smtp flags S keep state group 200


# pass icmp packets in and out
pass in quick on net0 proto icmp from any to net0/32  keep state group 100
pass out quick on net0 proto icmp from net0/32 to any keep state group 200

# block and ignore NETBIOS packets
block in quick on net0 proto tcp from any \
to any port = 135 flags S keep state group 100

block in quick on net0 proto tcp from any port = 137 \
to any flags S keep state group 100
block in quick on net0 proto udp from any to any port = 137 group 100
block in quick on net0 proto udp from any port = 137 to any group 100

block in quick on net0 proto tcp from any port = 138 \
to any flags S keep state group 100
block in quick on net0 proto udp from any port = 138 to any group 100

block in quick on net0 proto tcp from any port = 139 to any flags S keep state
group 100
block in quick on net0 proto udp from any port = 139 to any group 100
```